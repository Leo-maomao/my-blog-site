<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>毛毛的产品日记 - 产品经理的思考与成长记录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Search Console 验证 -->
  <meta name="google-site-verification" content="t8yH4Xka-6y0snBv6nZRvbx1xK5OsYLup9UoncjYN3U">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="毛毛的产品日记 RSS" href="https://my-blog-site.leo-maomao.workers.dev/rss.xml">

  <!-- SEO Meta Tags -->
  <meta name="description" content="一个产品经理的个人博客，记录产品思考、用户体验分析、职场成长心得。分享AI产品、游戏产品、工具产品的设计理念与实践经验。">
  <meta name="keywords" content="产品经理,产品日记,产品体验,用户体验,UX设计,产品思考,职场成长,AI产品,游戏产品">
  <meta name="author" content="毛毛">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://my-blog-site.leo-maomao.workers.dev/">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://jqsmoygkbqukgnwzkxvq.supabase.co/storage/v1/object/public/assets/Favicon.png">
  <link rel="apple-touch-icon" href="https://jqsmoygkbqukgnwzkxvq.supabase.co/storage/v1/object/public/assets/Favicon.png">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://my-blog-site.leo-maomao.workers.dev/">
  <meta property="og:title" content="毛毛的产品日记 - 产品经理的思考与成长记录">
  <meta property="og:description" content="一个产品经理的个人博客，记录产品思考、用户体验分析、职场成长心得。">
  <meta property="og:image" content="https://jqsmoygkbqukgnwzkxvq.supabase.co/storage/v1/object/public/assets/IP1.png">
  <meta property="og:site_name" content="毛毛的产品日记">
  <meta property="og:locale" content="zh_CN">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="毛毛的产品日记 - 产品经理的思考与成长记录">
  <meta name="twitter:description" content="一个产品经理的个人博客，记录产品思考、用户体验分析、职场成长心得。">
  <meta name="twitter:image" content="https://jqsmoygkbqukgnwzkxvq.supabase.co/storage/v1/object/public/assets/IP1.png">

  <!-- 引入 Remix Icon 图标库 -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
  <!-- 引入自定义样式 -->
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
<!-- 跳过链接 - 无障碍导航 -->
<a href="#main-content" class="skip-link">跳过导航，直达内容</a>

<div id="top" class="page-wrap">
  <!-- 顶部导航 -->
  <header class="site-header">
    <div class="container nav-inner">
      <div class="brand">
        <a href="./">毛毛的产品日记</a>
      </div>
      <nav class="nav-links" aria-label="主导航">
        <a href="./" class="nav-link is-active">首页</a>
        <a href="./diary.html" class="nav-link">产品日记</a>
        <a href="./experience.html" class="nav-link">产品体验</a>
        <a href="./notes.html" class="nav-link">随手记录</a>
      </nav>
      <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="打开菜单" aria-expanded="false">
        ☰
      </button>
    </div>
  </header>

  <main id="main-content">
    <!-- 区块 1：推荐文章 Banner -->
    <section class="hero" aria-label="推荐文章">
      <div class="container">
        <div class="hero-banner" id="latest" style="display: none;">
          <div class="banner-wrapper" id="bannerWrapper">
            <div class="banner-loading">加载中...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 区块 2：专栏分类 -->
    <section id="categories" aria-label="内容专栏">
      <div class="container">
        <div class="section-head">
          <div>
            <h2 class="section-title">内容专栏</h2>
          </div>
        </div>

        <div class="posts-grid">
          <article class="post-card is-active" data-category="diary">
            <h3 class="post-title">产品日记</h3>
            <div class="post-meta">更偏过程感的记录 · 以后文章会归在这里</div>
            <div class="post-card-media post-card-media--diary"></div>
          </article>

          <article class="post-card" data-category="experience">
            <h3 class="post-title">产品体验</h3>
            <div class="post-meta">用用户视角看产品 · 细节拆解和体验记录</div>
            <div class="post-card-media post-card-media--experience"></div>
          </article>

          <article class="post-card" data-category="notes">
            <h3 class="post-title">随手记录</h3>
            <div class="post-meta">不一定成文的想法 · 灵感和角落里的小句子</div>
            <div class="post-card-media post-card-media--notes"></div>
          </article>
        </div>
        <div class="category-list" id="category-list"></div>
      </div>
    </section>

    <!-- 区块 3：关于毛毛 -->
    <section aria-label="关于作者">
      <div class="container">
        <div class="about-card">
          <div class="about-main">
            <h2 class="about-name">毛毛</h2>
            <div class="about-role">高级产品经理 · 游戏 / 工具 / AI方向</div>
            <div class="about-tagline">永远相信美好的事即将发生。</div>
            <p class="about-body">
              这个网站会记录我在产品、项目和职场里的想法，不是教科书，
              更像一份给自己的长期备忘录。
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 移动端菜单 -->
  <nav class="mobile-menu" id="mobileMenu" aria-label="移动端导航">
    <a href="./" class="mobile-menu-link is-active">首页</a>
    <a href="./diary.html" class="mobile-menu-link">产品日记</a>
    <a href="./experience.html" class="mobile-menu-link">产品体验</a>
    <a href="./notes.html" class="mobile-menu-link">随手记录</a>
  </nav>

  <!-- 底部 -->
  <footer>
    <div class="container footer-inner">
      <div>© 2025 写给自己的产品日记</div>
      <div class="footer-links">
        <a href="https://my-nav-site.leo-maomao.workers.dev/" target="_blank" rel="noopener noreferrer">毛毛的导航站</a>
        <a href="https://my-tools-site.leo-maomao.workers.dev/" target="_blank" rel="noopener noreferrer">毛毛的工具箱</a>
      </div>
    </div>
  </footer>
</div>

<!-- 回到顶部按钮 -->
<button class="fab-btn back-to-top" id="backToTop" aria-label="回到顶部">
  <i class="ri-arrow-up-line"></i>
</button>

<!-- 微信群二维码浮窗 -->
<div class="wechat-qr-float" id="wechatQrFloat" style="display: none;">
  <div class="wechat-qr-close" id="wechatQrClose">
    <i class="ri-close-line"></i>
  </div>
  <div class="wechat-qr-content">
    <div class="wechat-qr-title">欢迎加入毛毛的产品小屋</div>
    <img id="wechatQrImage" src="" alt="微信群二维码" class="wechat-qr-image" style="display: none;">
    <div class="wechat-qr-loading" id="wechatQrLoading">加载中...</div>
  </div>
</div>

<!-- 微信群按钮（折叠状态） -->
<div class="fab-btn wechat-qr-btn" id="wechatQrBtn" title="加入微信群" style="display: none;">
  <i class="ri-wechat-line"></i>
</div>

<!-- 意见反馈按钮 -->
<div class="fab-btn feedback-btn" id="feedbackBtn" title="意见反馈">
  <i class="ri-feedback-line"></i>
</div>

<!-- 意见反馈弹窗 -->
<div id="feedbackModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="feedbackModalTitle">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="feedbackModalTitle">意见反馈</h3>
      <i class="ri-close-line modal-close" id="feedbackModalClose" role="button" aria-label="关闭"></i>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label for="feedbackContent">反馈内容 <span style="color: var(--color-danger);">*</span></label>
        <textarea id="feedbackContent" class="modal-input" placeholder="请描述您的问题、建议或想法" style="height: 120px; resize: none;" maxlength="500"></textarea>
      </div>
      <div class="modal-input-group">
        <label for="feedbackContact">联系方式 (选填)</label>
        <input id="feedbackContact" class="modal-input" placeholder="邮箱或微信号，方便我们回复您">
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel" id="feedbackCancelBtn">取消</button>
      <button class="modal-btn confirm" id="feedbackSubmitBtn">提交反馈</button>
    </div>
  </div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- 引入核心脚本 -->
<script src="./js/script.js"></script>

<!-- 51.la 数据统计 -->
<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"3OJQV6PxLHJ8VpH5",ck:"3OJQV6PxLHJ8VpH5"})</script>

<!-- 页面专属脚本 -->
<script>
(function() {
  'use strict';

  // ========================================
  // 移动端菜单功能
  // ========================================
  const toggleBtn = document.getElementById('mobileMenuToggle');
  const mobileMenu = document.getElementById('mobileMenu');
  
  if (toggleBtn && mobileMenu) {
    const mobileLinks = mobileMenu.querySelectorAll('.mobile-menu-link');
    
    toggleBtn.addEventListener('click', function() {
      const isExpanded = mobileMenu.classList.toggle('active');
      toggleBtn.setAttribute('aria-expanded', isExpanded);
    });
    
    mobileLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        mobileMenu.classList.remove('active');
        toggleBtn.setAttribute('aria-expanded', 'false');
      });
    });
    
    document.addEventListener('click', function(e) {
      if (!mobileMenu.contains(e.target) && !toggleBtn.contains(e.target)) {
        mobileMenu.classList.remove('active');
        toggleBtn.setAttribute('aria-expanded', 'false');
      }
    });
  }

  // ========================================
  // 回到顶部按钮
  // ========================================
  const backToTopBtn = document.getElementById('backToTop');
  
  if (backToTopBtn) {
    window.addEventListener('scroll', function() {
      if (window.scrollY > 300) {
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
      }
    }, { passive: true });
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // ========================================
  // 导航栏滚动隐藏
  // ========================================
  const header = document.querySelector('.site-header');
  if (header) {
    let lastY = window.scrollY || 0;
    let ticking = false;

    function handleScroll() {
      const currentY = window.scrollY || 0;
      const delta = currentY - lastY;

      if (Math.abs(delta) < 4) {
        lastY = currentY;
        return;
      }

      if (currentY > 80 && delta > 0) {
        header.classList.add('is-hidden');
      } else {
        header.classList.remove('is-hidden');
      }

      lastY = currentY;
    }

    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
  }

  // ========================================
  // 加载 Banner
  // ========================================
  async function loadBanner() {
    let attempts = 0;
    const maxAttempts = 50;
    
    while (!window.blogSupabaseClient && attempts < maxAttempts) {
      await new Promise(resolve => setTimeout(resolve, 100));
      attempts++;
    }

    if (!window.blogSupabaseClient) return;

    const bannerWrapper = document.getElementById('bannerWrapper');
    const banner = document.getElementById('latest');
    if (!banner || !bannerWrapper) return;

    try {
      const { data: posts, error } = await window.blogSupabaseClient
        .from('blog_posts')
        .select('id, title, excerpt, cover, category, created_at')
        .eq('published', true)
        .order('created_at', { ascending: false })
        .limit(5);

      if (error) throw error;
      if (!posts || posts.length === 0) {
        banner.style.display = 'none';
        return;
      }

      bannerWrapper.innerHTML = '';

      posts.forEach(function(post, i) {
        const slide = document.createElement('div');
        slide.className = 'banner-slide' + (i === 0 ? ' active' : '');
        slide.style.backgroundImage = 'url(' + (post.cover || 'https://images.unsplash.com/photo-1499750310107-5fef28a66643?auto=format&fit=crop&w=1600&q=80') + ')';

        slide.onclick = function() {
          if (typeof trackEvent === 'function') {
            trackEvent('banner_click', { article_id: post.id, article_title: post.title });
          }
          window.location.href = './post.html?id=' + post.id;
        };

        const content = document.createElement('div');
        content.className = 'banner-content';

        const title = document.createElement('div');
        title.className = 'banner-title';
        title.textContent = post.title || '无标题';

        const desc = document.createElement('div');
        desc.className = 'banner-desc';
        desc.textContent = post.excerpt || '';

        content.appendChild(title);
        content.appendChild(desc);
        slide.appendChild(content);
        bannerWrapper.appendChild(slide);
      });

      // 创建指示器
      const indicatorsDiv = document.createElement('div');
      indicatorsDiv.className = 'banner-indicators';

      posts.forEach(function(_, i) {
        const indicator = document.createElement('div');
        indicator.className = 'banner-indicator' + (i === 0 ? ' active' : '');
        indicator.setAttribute('data-index', i);
        indicatorsDiv.appendChild(indicator);
      });

      bannerWrapper.appendChild(indicatorsDiv);
      banner.style.display = 'block';

      // 轮播功能
      if (posts.length > 1) {
        const slides = bannerWrapper.querySelectorAll('.banner-slide');
        const indicators = bannerWrapper.querySelectorAll('.banner-indicator');
        let current = 0;
        const interval = 5000;
        let timer = null;

        function showSlide(index) {
          if (index < 0 || index >= slides.length) return;
          current = index;

          slides.forEach(function(s, i) {
            s.classList.toggle('active', i === current);
          });
          indicators.forEach(function(ind, i) {
            ind.classList.toggle('active', i === current);
          });
        }

        function startTimer() {
          if (timer) clearInterval(timer);
          timer = setInterval(function() {
            showSlide((current + 1) % slides.length);
          }, interval);
        }

        indicators.forEach(function(ind, index) {
          ind.addEventListener('click', function() {
            showSlide(index);
            startTimer();
          });
        });

        startTimer();
      }

      setTimeout(function() {
        banner.classList.add('is-entered');
      }, 100);

    } catch (error) {
      banner.style.display = 'none';
    }
  }

  loadBanner();

  // ========================================
  // 专栏切换功能
  // ========================================
  const cards = document.querySelectorAll('.posts-grid .post-card');
  const listEl = document.getElementById('category-list');
  
  if (cards.length && listEl) {
    const data = {
      diary: { label: '产品日记', link: './diary.html', items: [] },
      experience: { label: '产品体验', link: './experience.html', items: [] },
      notes: { label: '随手记录', link: './notes.html', items: [] }
    };

    let isDataLoaded = false;

    async function loadArticleData() {
      if (!window.blogSupabaseClient) return;

      try {
        const { data: posts, error } = await window.blogSupabaseClient
          .from('blog_posts')
          .select('id, title, excerpt, cover, category, created_at, likes, initial_likes')
          .eq('published', true)
          .order('created_at', { ascending: false });

        if (error) return;

        (posts || []).forEach(function(post) {
          const cat = post.category;
          if (data[cat]) {
            const date = new Date(post.created_at);
            const dateStr = date.getFullYear() + '-' +
              String(date.getMonth() + 1).padStart(2, '0') + '-' +
              String(date.getDate()).padStart(2, '0');

            data[cat].items.push({
              title: post.title,
              excerpt: post.excerpt || '',
              date: dateStr,
              cover: post.cover || 'https://images.unsplash.com/photo-1499750310107-5fef28a66643?auto=format&fit=crop&w=600&q=80',
              link: './post.html?id=' + post.id,
              likes: (post.initial_likes || 0) + (post.likes || 0)
            });
          }
        });

        isDataLoaded = true;

        const activeCard = document.querySelector('.posts-grid .post-card.is-active');
        if (activeCard) {
          const key = activeCard.getAttribute('data-category');
          renderList(key);
        }
      } catch (error) {
        // 静默处理
      }
    }

    function renderList(key) {
      const cfg = data[key] || {};
      const items = cfg.items || [];
      
      if (!items.length) {
        listEl.innerHTML = '';
        listEl.className = 'category-list';
        return;
      }

      const sorted = items.slice().sort(function(a, b) {
        return a.date < b.date ? 1 : -1;
      });
      const visible = sorted.slice(0, 10);
      const link = cfg.link || '#';

      let html = '<div class="category-list-header">';
      html += '<div><div class="category-list-title">最近更新</div></div>';
      html += '<a class="category-list-more" href="' + link + '">查看更多<span class="category-list-more-icon">↗</span></a>';
      html += '</div>';

      html += '<ul class="category-list-items">';
      visible.forEach(function(item) {
        html += '<li class="category-item category-item--clickable" data-link="' + item.link + '">';
        html += '<div class="category-item-thumb" style="background-image:url(\'' + item.cover + '\');"></div>';
        html += '<div class="category-item-content">';
        html += '<div class="category-item-title">' + item.title + '</div>';
        if (item.excerpt) {
          html += '<div class="category-item-excerpt">' + item.excerpt + '</div>';
        }
        html += '<div class="category-item-date">' + item.date + '</div>';
        html += '<div class="category-item-likes"><i class="ri-heart-fill" style="color:var(--color-danger);margin-right:3px;"></i>' + item.likes + '</div>';
        html += '</div></li>';
      });
      html += '</ul>';
      
      listEl.innerHTML = html;
      listEl.className = 'category-list category-list--' + key;

      listEl.querySelectorAll('.category-item--clickable').forEach(function(card) {
        const url = card.getAttribute('data-link');
        if (url) {
          card.addEventListener('click', function() {
            window.location.href = url;
          });
        }
      });
    }

    function setActive(card) {
      cards.forEach(function(c) {
        c.classList.remove('is-active');
      });
      card.classList.add('is-active');
    }

    cards.forEach(function(card) {
      card.addEventListener('click', function() {
        const key = card.getAttribute('data-category');
        if (!key) return;
        setActive(card);
        renderList(key);

        // 埋点
        const tabNameMap = { diary: '产品日记', experience: '产品体验', notes: '随手记录' };
        if (typeof trackEvent === 'function') {
          trackEvent('column_tab_click', { tab_name: tabNameMap[key] || key });
        }
      });
    });

    // 查看更多埋点
    listEl.addEventListener('click', function(e) {
      const moreLink = e.target.closest('.category-list-more');
      if (moreLink && typeof trackEvent === 'function') {
        const href = moreLink.getAttribute('href') || '';
        let tabName = '';
        if (href.includes('diary')) tabName = '产品日记';
        else if (href.includes('experience')) tabName = '产品体验';
        else if (href.includes('notes')) tabName = '随手记录';
        if (tabName) trackEvent('column_more_click', { tab_name: tabName });
      }
    });

    // 初始化加载
    async function initLoad() {
      let attempts = 0;
      const maxAttempts = 50;
      while (!window.blogSupabaseClient && attempts < maxAttempts) {
        await new Promise(resolve => setTimeout(resolve, 100));
        attempts++;
      }
      if (window.blogSupabaseClient) loadArticleData();
    }

    initLoad();
  }

  // ========================================
  // 加载专栏图片
  // ========================================
  (async function() {
    if (!window.blogSupabaseClient) return;

    try {
      const { data, error } = await window.blogSupabaseClient
        .from('column_images')
        .select('column_key, image_url');

      if (error) throw error;

      if (data && data.length > 0) {
        data.forEach(function(item) {
          const element = document.querySelector('.post-card-media--' + item.column_key);
          if (element) {
            element.style.backgroundImage = 'url("' + item.image_url + '")';
          }
        });
      }
    } catch (error) {
      // 静默处理
    }
  })();
})();
</script>
</body>
</html>
